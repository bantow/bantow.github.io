var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function u(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,u)}c((n=n.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(c){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}};!function(){__awaiter(this,void 0,void 0,(function(){var e,t,r,n;return __generator(this,(function(i){switch(i.label){case 0:if(e=function(){function e(e){var t=e.appDriveConfig,r=e.appDriveWrapper;this.appDriveWrapper=r,this.config=t,this.timeoutId=null}return e.prototype.forNextTick=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){return[2,new Promise((function(t){e.timeoutId=setTimeout((function(){var r=e.config,n=r.deepLinkUriScheme,i=r.refSrc;location.href=n+"/?ref_src=".concat(i),t(!0)}),0)}))]}))}))},e.prototype.openDeepLink=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return this.config.shouldDriveDeepLink?[4,e.nextFrame()]:[2];case 1:return t.sent(),[4,this.forNextTick()];case 2:return t.sent(),[2]}}))}))},e.prototype.driveAppDownload=function(){return __awaiter(this,void 0,void 0,(function(){var t,r=this;return __generator(this,(function(n){switch(n.label){case 0:return t=function(){return __awaiter(r,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,e.nextFrame()];case 1:return t.sent(),location.href=this.config.storeLink,[4,e.sleep(3)];case 2:return t.sent(),[2]}}))}))},this.config.shouldNativeDialog?[4,e.sleep(.1)]:[3,5];case 1:return n.sent(),window.confirm(this.config.confirmMsg)?[4,t()]:[3,3];case 2:return n.sent(),[3,4];case 3:return clearTimeout(this.timeoutId),[2];case 4:return[3,7];case 5:return[4,t()];case 6:n.sent(),n.label=7;case 7:return[2]}}))}))},e.prototype.promoteWorker=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,this.openDeepLink()];case 1:return e.sent(),[4,this.driveAppDownload()];case 2:return e.sent(),[3,4];case 3:return e.sent(),[3,4];case 4:return window.dispatchEvent(new Event("load")),[2]}}))}))},e.prototype.renderSplash=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){return[2,new Promise((function(t){var r=e.appDriveWrapper.querySelector("#splash-fragment");r&&document.querySelector("body").appendChild(r.content.cloneNode(!0));var n=new Image;n.src=e.config.splashImgUrl,n.onload=function(){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){return t(!0),[2]}))}))}}))]}))}))},e.prototype.render=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return this.config.shouldInsertSplash?[4,this.renderSplash()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this.promoteWorker()];case 3:return t.sent(),(e=document.querySelector(".splash-container"))&&(e.style.display="none"),[2]}}))}))},e.sleep=function(e){return new Promise((function(t){return setTimeout(t,1e3*e)}))},e.nextFrame=function(){return new Promise(window.requestAnimationFrame)},e}(),!(t=document.querySelector(".app-drive-wrapper")))return[3,2];r=t.getAttribute("data-app-drive-config"),n={};try{n=JSON.parse(r)}catch(e){}return[4,new e({appDriveConfig:n,appDriveWrapper:t}).render()];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}();